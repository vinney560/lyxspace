<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Stats | LyxSpace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #111827; color: #F9FAFB; }
        .section { margin-bottom: 2.5rem; }
        .section h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; background: linear-gradient(90deg,#3B82F6,#8B5CF6); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; color: transparent; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        th, td { padding: 8px 12px; border-bottom: 1px solid rgba(255,255,255,0.08); text-align: left; }
        th { background: rgba(59,130,246,0.15); color: #93C5FD; font-weight: 600; }
        tr:hover { background: rgba(255,255,255,0.04); }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .badge-pdf { background: #F59E0B; color: #fff; }
        .badge-img { background: #10B981; color: #fff; }
        .stats-card { background: rgba(30,30,40,0.6); border-radius: 15px; padding: 20px; text-align: center; border: 1px solid rgba(59,130,246,0.3); margin-bottom: 1.5rem; }
    </style>
</head>
<body>
    <nav class="glass-morph sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="logo-container">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline><polyline points="7.5 19.79 7.5 14.6 3 12"></polyline><polyline points="21 12 16.5 14.6 16.5 19.79"></polyline><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                </div>
                <span class="text-xl font-bold gradient-text">LyxSpace Admin Stats</span>
            </div>
            <div class="flex items-center space-x-4">
                <a href="{{ url_for('admin_panel') }}" class="btn"><i class="fas fa-arrow-left mr-2"></i>Back</a>
                <a href="{{ url_for('logout') }}" class="btn btn-danger"><i class="fas fa-sign-out-alt mr-2"></i></a>
            </div>
        </div>
    </nav>
    <main class="max-w-6xl mx-auto px-4 py-8">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="stats-card"><div class="text-2xl font-bold">{{ users|length }}</div><div class="text-gray-400">Users</div></div>
            <div class="stats-card"><div class="text-2xl font-bold">{{ files|length }}</div><div class="text-gray-400">Files (Images)</div></div>
            <div class="stats-card"><div class="text-2xl font-bold">{{ filestores|length }}</div><div class="text-gray-400">Files (PDFs)</div></div>
            <div class="stats-card"><div class="text-2xl font-bold">{{ courses|length }}</div><div class="text-gray-400">Courses</div></div>
            <div class="stats-card"><div class="text-2xl font-bold">{{ modules|length }}</div><div class="text-gray-400">Modules</div></div>
            <div class="stats-card"><div class="text-2xl font-bold">{{ enrollments|length }}</div><div class="text-gray-400">Enrollments</div></div>
            <div class="stats-card"><div class="text-2xl font-bold">{{ progresses|length }}</div><div class="text-gray-400">Progress Records</div></div>
        </div>
        <div class="section">
            <h2><i class="fas fa-users mr-2"></i>Users</h2>
            <table><thead><tr><th>ID</th><th>Mobile</th><th>Username</th><th>Login At</th><th>Status</th></tr></thead><tbody>
                {% for u in users %}
                <tr><td>{{ u.id }}</td><td>{{ u.mobile }}</td><td>{{ u.username or 'N/A' }}</td><td>{{ u.login_at.strftime('%Y-%m-%d %H:%M') }}</td><td>{% if u.is_allowed %}<span class="badge" style="background:#10B981;color:#fff">Allowed</span>{% else %}<span class="badge" style="background:#F59E0B;color:#fff">Pending</span>{% endif %}</td></tr>
                {% endfor %}
            </tbody></table>
        </div>
        <div class="section">
            <h2><i class="fas fa-file-image mr-2"></i>Files (Images)</h2>
            <table><thead><tr><th>ID</th><th>Filename</th><th>Type</th><th>Upload Date</th><th>Description</th><th>Uploader</th></tr></thead><tbody>
                {% for f in files %}
                <tr><td>{{ f.id }}</td><td>{{ f.filename }}</td><td><span class="badge badge-img">{{ f.file_type }}</span></td><td>{{ f.upload_date.strftime('%Y-%m-%d %H:%M') }}</td><td>{{ f.description or 'N/A' }}</td><td>{{ f.uploader_id }}</td></tr>
                {% endfor %}
            </tbody></table>
        </div>
        <div class="section">
            <h2><i class="fas fa-file-pdf mr-2"></i>Files (PDFs)</h2>
            <table><thead><tr><th>ID</th><th>Filename</th><th>Upload Date</th><th>Description</th><th>Uploader</th></tr></thead><tbody>
                {% for f in filestores %}
                <tr><td>{{ f.id }}</td><td>{{ f.filename }}</td><td>{{ f.upload_date.strftime('%Y-%m-%d %H:%M') }}</td><td>{{ f.description or 'N/A' }}</td><td>{{ f.uploader_id }}</td></tr>
                {% endfor %}
            </tbody></table>
        </div>
        <div class="section">
            <h2><i class="fas fa-book mr-2"></i>Courses</h2>
            <table><thead><tr><th>ID</th><th>Title</th><th>Instructor</th><th>Category</th><th>Students</th><th>Created</th></tr></thead><tbody>
                {% for c in courses %}
                <tr><td>{{ c.id }}</td><td>{{ c.title }}</td><td>{{ c.instructor }}</td><td>{{ c.category }}</td><td>{{ c.students }}</td><td>{{ c.created_at.strftime('%Y-%m-%d') }}</td></tr>
                {% endfor %}
            </tbody></table>
        </div>
        <div class="section">
            <h2><i class="fas fa-layer-group mr-2"></i>Modules</h2>
            <table><thead><tr><th>ID</th><th>Course</th><th>Title</th><th>Lessons</th><th>Duration</th><th>Created</th></tr></thead><tbody>
                {% for m in modules %}
                <tr><td>{{ m.id }}</td><td>{{ m.course_id }}</td><td>{{ m.title }}</td><td>{{ m.lessons }}</td><td>{{ m.duration }}</td><td>{{ m.created_at.strftime('%Y-%m-%d') }}</td></tr>
                {% endfor %}
            </tbody></table>
        </div>
        <div class="section">
            <h2><i class="fas fa-user-graduate mr-2"></i>Enrollments</h2>
            <table><thead><tr><th>ID</th><th>User</th><th>Course</th><th>Enrolled At</th><th>Completed</th><th>Progress</th></tr></thead><tbody>
                {% for e in enrollments %}
                <tr><td>{{ e.id }}</td><td>{{ e.user_id }}</td><td>{{ e.course_id }}</td><td>{{ e.enrolled_at.strftime('%Y-%m-%d') }}</td><td>{% if e.completed_at %}{{ e.completed_at.strftime('%Y-%m-%d') }}{% else %}No{% endif %}</td><td>{{ (e.progress * 100)|round(1) }}%</td></tr>
                {% endfor %}
            </tbody></table>
        </div>
        <div class="section">
            <h2><i class="fas fa-tasks mr-2"></i>User Progress</h2>
            <table><thead><tr><th>ID</th><th>User</th><th>Course</th><th>Module</th><th>Lesson</th><th>Completed</th><th>Score</th><th>Time Spent</th></tr></thead><tbody>
                {% for p in progresses %}
                <tr><td>{{ p.id }}</td><td>{{ p.user_id }}</td><td>{{ p.course_id }}</td><td>{{ p.module_id }}</td><td>{{ p.lesson_id }}</td><td>{% if p.completed %}Yes{% else %}No{% endif %}</td><td>{{ p.score }}</td><td>{{ p.time_spent }}s</td></tr>
                {% endfor %}
            </tbody></table>
        </div>
    </main>
</body>
</html>
